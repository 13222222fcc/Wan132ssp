-- ROBLOX Wan 脚本 (使用 Rayfield UI)
-- 作者: Wan
-- 版本: 1.0

local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local SoundService = game:GetService("SoundService")
local HttpService = game:GetService("HttpService")

-- 加载 Rayfield UI 库
local Rayfield = loadstring(game:HttpGet('https://raw.githubusercontent.com/12dafs/Rayfield/main/source.lua'))()

-- 权限检查
if LocalPlayer.Name == "AQ14ABS" or LocalPlayer.Name == "edc12363" or LocalPlayer.Name == "onygfvjop" or LocalPlayer.Name == "ah_kdj3" or LocalPlayer.Name == "luoyang100616" or LocalPlayer.Name == "hdjdje675" or LocalPlayer.Name == "qazwsxuruu" or LocalPlayer.Name == "ADCZ4xx" or LocalPlayer.Name == "hjcjb96" or LocalPlayer.Name == "TM5418888" or LocalPlayer.Name == "codm656558" then
    LocalPlayer:Kick("Exploiting")
else
    -- 显示启动通知
    Rayfield:Notify({
        Title = "Wan通知",
        Content = "启动中",
        Duration = 2.5
    })
    
    -- 播放启动音效
    local Sound = Instance.new("Sound")
    Sound.SoundId = "rbxassetid://4590662766"
    Sound.Parent = SoundService
    Sound.Volume = 5
    Sound:Play()
    Sound.Ended:Wait()
    Sound:Destroy()
    
    -- 创建主窗口
    local Window = Rayfield:CreateWindow({
        Name = "Wan",
        LoadingTitle = "Wan",
        LoadingSubtitle = "加载中",
        ConfigurationSaving = {
            Enabled = false
        },
        Discord = {
            Enabled = false
        },
        KeySystem = false
    })
    
    -- 标签页1 信息
    local Tab1 = Window:CreateTab("信息", 4483345998)
    
    Tab1:CreateLabel("你的名称")
    Tab1:CreateLabel(LocalPlayer.Name, true)
    Tab1:CreateLabel("初审人员")
    Tab1:CreateLabel("FengYu", true)
    Tab1:CreateLabel("DREAD849", true)
    Tab1:CreateLabel("QQ 123", true)
    Tab1:CreateLabel("如果你是最先使用人员，请记住这段以后会加的卡密系统 Wan 0 2 4 5 9 4", true)
    
    -- 标签页2 全局通用
    local Tab2 = Window:CreateTab("全局通用", 4483345998)
    
    -- Fly功能变量
    local flyEnabled = false
    local flySpeed = 50
    local bodyVelocity = nil
    local bodyGyro = nil
    
    -- Fly开关
    Tab2:CreateToggle({
        Name = "Fly",
        CurrentValue = false,
        Flag = "FlyToggle",
        Callback = function(Value)
            flyEnabled = Value
            local Character = LocalPlayer.Character
            if Character then
                local HumanoidRootPart = Character:FindFirstChild("HumanoidRootPart")
                if HumanoidRootPart then
                    if flyEnabled then
                        bodyVelocity = Instance.new("BodyVelocity")
                        bodyVelocity.Velocity = Vector3.new(0, 0, 0)
                        bodyVelocity.MaxForce = Vector3.new(4000, 4000, 4000)
                        bodyVelocity.Parent = HumanoidRootPart
                        
                        bodyGyro = Instance.new("BodyGyro")
                        bodyGyro.CFrame = HumanoidRootPart.CFrame
                        bodyGyro.MaxTorque = Vector3.new(4000, 4000, 4000)
                        bodyGyro.Parent = HumanoidRootPart
                    else
                        if bodyVelocity then
                            bodyVelocity:Destroy()
                            bodyVelocity = nil
                        end
                        if bodyGyro then
                            bodyGyro:Destroy()
                            bodyGyro = nil
                        end
                    end
                end
            end
        end
    })
    
    -- Fly速度滑块
    Tab2:CreateSlider({
        Name = "Fly速度",
        Range = {0, 99999},
        Increment = 1,
        Suffix = "",
        CurrentValue = 50,
        Flag = "FlySpeedSlider",
        Callback = function(Value)
            flySpeed = Value
        end
    })
    
    -- 飞车功能变量
    local vehicleFlyEnabled = false
    local vehicleFlySpeed = 100
    
    -- 飞车开关
    Tab2:CreateToggle({
        Name = "飞车",
        CurrentValue = false,
        Flag = "VehicleFlyToggle",
        Callback = function(Value)
            vehicleFlyEnabled = Value
        end
    })
    
    -- 飞车速度输入框
    Tab2:CreateInput({
        Name = "飞车速度",
        PlaceholderText = "输入速度",
        RemoveTextAfterFocusLost = false,
        Flag = "VehicleFlySpeedInput",
        Callback = function(Value)
            vehicleFlySpeed = tonumber(Value) or 100
        end
    })
    
    -- 透视功能变量
    local highlights = {}
    local highlightStates = {
        ["彩色描边"] = false,
        ["紫色描边"] = false,
        ["绿色描边"] = false,
        ["红色描边"] = false
    }
    
    -- 更新高亮显示
    local function updateHighlights()
        -- 清除现有高亮
        for _, highlight in pairs(highlights) do
            if highlight and highlight.Parent then
                highlight:Destroy()
            end
        end
        highlights = {}
        
        -- 确定当前选择的颜色
        local selectedColor = Color3.new(1, 1, 1) -- 默认白色
        if highlightStates["紫色描边"] then
            selectedColor = Color3.fromRGB(128, 0, 128)
        elseif highlightStates["绿色描边"] then
            selectedColor = Color3.fromRGB(0, 255, 0)
        elseif highlightStates["红色描边"] then
            selectedColor = Color3.fromRGB(255, 0, 0)
        end
        
        -- 为每个玩家创建高亮
        for _, Player in ipairs(Players:GetPlayers()) do
            if Player ~= LocalPlayer and Player.Character then
                local Character = Player.Character
                local HumanoidRootPart = Character:FindFirstChild("HumanoidRootPart")
                if HumanoidRootPart then
                    local highlight = Instance.new("Highlight")
                    highlight.FillTransparency = 1
                    highlight.OutlineColor = selectedColor
                    highlight.Parent = Character
                    table.insert(highlights, highlight)
                end
            end
        end
    end
    
    -- 彩色描边开关
    Tab2:CreateToggle({
        Name = "彩色描边",
        CurrentValue = false,
        Flag = "ColorOutlineToggle",
        Callback = function(Value)
            highlightStates["彩色描边"] = Value
            if Value then
                -- 关闭其他选项
                highlightStates["紫色描边"] = false
                highlightStates["绿色描边"] = false
                highlightStates["红色描边"] = false
            end
            updateHighlights()
        end
    })
    
    -- 紫色描边开关
    Tab2:CreateToggle({
        Name = "紫色描边",
        CurrentValue = false,
        Flag = "PurpleOutlineToggle",
        Callback = function(Value)
            highlightStates["紫色描边"] = Value
            if Value then
                highlightStates["彩色描边"] = false
                highlightStates["绿色描边"] = false
                highlightStates["红色描边"] = false
            end
            updateHighlights()
        end
    })
    
    -- 绿色描边开关
    Tab2:CreateToggle({
        Name = "绿色描边",
        CurrentValue = false,
        Flag = "GreenOutlineToggle",
        Callback = function(Value)
            highlightStates["绿色描边"] = Value
            if Value then
                highlightStates["彩色描边"] = false
                highlightStates["紫色描边"] = false
                highlightStates["红色描边"] = false
            end
            updateHighlights()
        end
    })
    
    -- 红色描边开关
    Tab2:CreateToggle({
        Name = "红色描边",
        CurrentValue = false,
        Flag = "RedOutlineToggle",
        Callback = function(Value)
            highlightStates["红色描边"] = Value
            if Value then
                highlightStates["彩色描边"] = false
                highlightStates["紫色描边"] = false
                highlightStates["绿色描边"] = false
            end
            updateHighlights()
        end
    })
    
    -- 无限体力功能
    Tab2:CreateToggle({
        Name = "无限体力",
        CurrentValue = false,
        Flag = "InfiniteStaminaToggle",
        Callback = function(Value)
            if Value then
                local Character = LocalPlayer.Character
                if Character then
                    local Stamina = Character:FindFirstChild("体力")
                    if Stamina then
                        Stamina.Value = 99999999
                    else
                        local NewStamina = Instance.new("IntValue")
                        NewStamina.Name = "体力"
                        NewStamina.Value = 99999999
                        NewStamina.Parent = Character
                    end
                end
            end
        end
    })
    
    -- 标签页3 音乐播放器
    local Tab3 = Window:CreateTab("音乐播放器", 4483345998)
    
    local CurrentSound = nil
    local MusicId = ""
    
    -- 音乐ID输入框
    Tab3:CreateInput({
        Name = "音乐ID",
        PlaceholderText = "输入音乐ID",
        RemoveTextAfterFocusLost = false,
        Flag = "MusicIdInput",
        Callback = function(Value)
            MusicId = Value
        end
    })
    
    -- 播放按钮
    Tab3:CreateButton({
        Name = "播放音乐",
        Callback = function()
            if CurrentSound then
                CurrentSound:Stop()
                CurrentSound:Destroy()
            end
            
            if MusicId ~= "" then
                CurrentSound = Instance.new("Sound")
                CurrentSound.SoundId = "rbxassetid://" .. MusicId
                CurrentSound.Volume = 1
                CurrentSound.Parent = SoundService
                CurrentSound:Play()
            end
        end
    })
    
    -- 停止按钮
    Tab3:CreateButton({
        Name = "停止",
        Callback = function()
            if CurrentSound then
                CurrentSound:Stop()
                CurrentSound:Destroy()
                CurrentSound = nil
            end
        end
    })
    
    -- 飞行控制循环
    RunService.Heartbeat:Connect(function()
        if flyEnabled and LocalPlayer.Character then
            local HumanoidRootPart = LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
            if HumanoidRootPart and bodyVelocity and bodyGyro then
                local Camera = workspace.CurrentCamera
                local Direction = Vector3.new()
                
                if UserInputService:IsKeyDown(Enum.KeyCode.W) then
                    Direction = Direction + Camera.CFrame.LookVector
                end
                if UserInputService:IsKeyDown(Enum.KeyCode.S) then
                    Direction = Direction - Camera.CFrame.LookVector
                end
                if UserInputService:IsKeyDown(Enum.KeyCode.A) then
                    Direction = Direction - Camera.CFrame.RightVector
                end
                if UserInputService:IsKeyDown(Enum.KeyCode.D) then
                    Direction = Direction + Camera.CFrame.RightVector
                end
                if UserInputService:IsKeyDown(Enum.KeyCode.Space) then
                    Direction = Direction + Vector3.new(0, 1, 0)
                end
                if UserInputService:IsKeyDown(Enum.KeyCode.LeftShift) then
                    Direction = Direction - Vector3.new(0, 1, 0)
                end
                
                if Direction.Magnitude > 0 then
                    Direction = Direction.Unit * flySpeed
                end
                
                bodyVelocity.Velocity = Direction
                bodyGyro.CFrame = Camera.CFrame
            end
        end
    end)
    
    print("Wan 脚本加载完成")
end
